{"ts":1366209556949,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1366209577879,"patch":[[{"diffs":[[1,"### UTILITY METHODS ###\r\n\r\ndef create_visitor\r\n  @visitor ||= { :name => \"Testy McUserton\", :email => \"example@example.com\",\r\n    :password => \"changeme\", :password_confirmation => \"changeme\" }\r\nend\r\n\r\ndef find_user\r\n  @user ||= User.first conditions: {:email => @visitor[:email]}\r\nend\r\n\r\ndef create_unconfirmed_user\r\n  create_visitor\r\n  delete_user\r\n  sign_up\r\n  visit '/users/sign_out'\r\nend\r\n\r\ndef create_user\r\n  create_visitor\r\n  delete_user\r\n  @user = FactoryGirl.create(:user, email: @visitor[:email])\r\nend\r\n\r\ndef delete_user\r\n  @user ||= User.first conditions: {:email => @visitor[:email]}\r\n  @user.destroy unless @user.nil?\r\nend\r\n\r\ndef sign_up\r\n  delete_user\r\n  visit '/users/sign_up'\r\n  fill_in \"Name\", :with => @visitor[:name]\r\n  fill_in \"Email\", :with => @visitor[:email]\r\n  fill_in \"user_password\", :with => @visitor[:password]\r\n  fill_in \"user_password_confirmation\", :with => @visitor[:password_confirmation]\r\n  click_button \"Sign up\"\r\n  find_user\r\nend\r\n\r\ndef sign_in\r\n  visit '/users/sign_in'\r\n  fill_in \"Email\", :with => @visitor[:email]\r\n  fill_in \"Password\", :with => @visitor[:password]\r\n  click_button \"Sign in\"\r\nend\r\n\r\n### GIVEN ###\r\nGiven /^I am not logged in$/ do\r\n  visit '/users/sign_out'\r\nend\r\n\r\nGiven /^I am logged in$/ do\r\n  create_user\r\n  sign_in\r\nend\r\n\r\nGiven /^I exist as a user$/ do\r\n  create_user\r\nend\r\n\r\nGiven /^I do not exist as a user$/ do\r\n  create_visitor\r\n  delete_user\r\nend\r\n\r\nGiven /^I exist as an unconfirmed user$/ do\r\n  create_unconfirmed_user\r\nend\r\n\r\n### WHEN ###\r\nWhen /^I sign in with valid credentials$/ do\r\n  create_visitor\r\n  sign_in\r\nend\r\n\r\nWhen /^I sign out$/ do\r\n  visit '/users/sign_out'\r\nend\r\n\r\nWhen /^I sign up with valid user data$/ do\r\n  create_visitor\r\n  sign_up\r\nend\r\n\r\nWhen /^I sign up with an invalid email$/ do\r\n  create_visitor\r\n  @visitor = @visitor.merge(:email => \"notanemail\")\r\n  sign_up\r\nend\r\n\r\nWhen /^I sign up without a password confirmation$/ do\r\n  create_visitor\r\n  @visitor = @visitor.merge(:password_confirmation => \"\")\r\n  sign_up\r\nend\r\n\r\nWhen /^I sign up without a password$/ do\r\n  create_visitor\r\n  @visitor = @visitor.merge(:password => \"\")\r\n  sign_up\r\nend\r\n\r\nWhen /^I sign up with a mismatched password confirmation$/ do\r\n  create_visitor\r\n  @visitor = @visitor.merge(:password_confirmation => \"changeme123\")\r\n  sign_up\r\nend\r\n\r\nWhen /^I return to the site$/ do\r\n  visit '/'\r\nend\r\n\r\nWhen /^I sign in with a wrong email$/ do\r\n  @visitor = @visitor.merge(:email => \"wrong@example.com\")\r\n  sign_in\r\nend\r\n\r\nWhen /^I sign in with a wrong password$/ do\r\n  @visitor = @visitor.merge(:password => \"wrongpass\")\r\n  sign_in\r\nend\r\n\r\nWhen /^I edit my account details$/ do\r\n  click_link \"Edit account\"\r\n  fill_in \"Name\", :with => \"newname\"\r\n  fill_in \"user_current_password\", :with => @visitor[:password]\r\n  click_button \"Update\"\r\nend\r\n\r\nWhen /^I look at the list of users$/ do\r\n  visit '/'\r\nend\r\n\r\n### THEN ###\r\nThen /^I should be signed in$/ do\r\n  page.should have_content \"Logout\"\r\n  page.should_not have_content \"Sign up\"\r\n  page.should_not have_content \"Login\"\r\nend\r\n\r\nThen /^I should be signed out$/ do\r\n  page.should have_content \"Sign up\"\r\n  page.should have_content \"Login\"\r\n  page.should_not have_content \"Logout\"\r\nend\r\n\r\nThen /^I see an unconfirmed account message$/ do\r\n  page.should have_content \"You have to confirm your account before continuing.\"\r\nend\r\n\r\nThen /^I see a successful sign in message$/ do\r\n  page.should have_content \"Signed in successfully.\"\r\nend\r\n\r\nThen /^I should see a successful sign up message$/ do\r\n  page.should have_content \"Welcome! You have signed up successfully.\"\r\nend\r\n\r\nThen /^I should see an invalid email message$/ do\r\n  page.should have_content \"Emailis invalid\"\r\nend\r\n\r\nThen /^I should see a missing password message$/ do\r\n  page.should have_content \"Passwordcan't be blank\"\r\nend\r\n\r\nThen /^I should see a missing password confirmation message$/ do\r\n  page.should have_content \"Passworddoesn't match confirmation\"\r\nend\r\n\r\nThen /^I should see a mismatched password message$/ do\r\n  page.should have_content \"Passworddoesn't match confirmation\"\r\nend\r\n\r\nThen /^I should see a signed out message$/ do\r\n  page.should have_content \"Signed out successfully.\"\r\nend\r\n\r\nThen /^I see an invalid login message$/ do\r\n  page.should have_content \"Invalid email or password.\"\r\nend\r\n\r\nThen /^I should see an account edited message$/ do\r\n  page.should have_content \"You updated your account successfully.\"\r\nend\r\n\r\nThen /^I should see my name$/ do\r\n  create_user\r\n  page.should have_content @user[:name]\r\nend"]],"start1":0,"start2":0,"length1":0,"length2":4498}]],"length":4498,"saved":false}
